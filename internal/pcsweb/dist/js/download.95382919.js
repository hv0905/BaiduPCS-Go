(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["download"],{3971:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-download"},[s("Sider",{attrs:{"hide-trigger":""}},[s("Menu",{attrs:{theme:"light",width:"auto","open-names":["1"],"active-name":t.select_menu_name},on:{"on-select":t.getMenuName}},[s("Submenu",{attrs:{name:"1"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-cloud-download"}}),t._v("我的下载")],1),s("MenuItem",{attrs:{name:"1-1"}},[t._v("正在下载")]),s("MenuItem",{attrs:{name:"1-2"}},[t._v("已经完成")])],2),s("Submenu",{attrs:{name:"2"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-cloud-upload"}}),t._v("我的上传")],1),s("MenuItem",{attrs:{name:"2-1"}},[t._v("正在上传")]),s("MenuItem",{attrs:{name:"2-2"}},[t._v("已经完成")])],2),s("Submenu",{attrs:{name:"3"}},[s("template",{slot:"title"},[s("Icon",{attrs:{type:"ios-link"}}),t._v("离线下载")],1),s("MenuItem",{attrs:{name:"3-1"}},[t._v("正在下载")]),s("MenuItem",{attrs:{name:"3-2"}},[t._v("已经完成")])],2)],1)],1),s("div",{staticClass:"p-main"},["1-1"===t.select_menu_name&&(t.globals.downloading.length||t.globals.pending_download.length)?s("div",{staticStyle:{"margin-bottom":"8px"}},[s("Button",{attrs:{size:"small",type:"error",ghost:""},on:{click:t.cancelAll}},[t._v("全部取消")])],1):t._e(),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.downloading,itype:1,istatus:2}}),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"1-1"===t.select_menu_name,expression:"select_menu_name === '1-1'"}],attrs:{items:t.globals.pending_download,itype:1,istatus:1}}),"1-2"===t.select_menu_name?s("v-finished",{attrs:{items:t.globals.downloaded,itype:1}}):t._e(),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.uploading,itype:2,istatus:2}}),s("v-download-process-item",{directives:[{name:"show",rawName:"v-show",value:"2-1"===t.select_menu_name,expression:"select_menu_name === '2-1'"}],attrs:{items:t.globals.pending_upload,itype:2,istatus:1}}),"2-2"===t.select_menu_name?s("v-finished",{attrs:{items:t.globals.uploaded,itype:2}}):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:"3-1"===t.select_menu_name,expression:"select_menu_name === '3-1'"}]},[s("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[s("Row",[s("Col",{attrs:{span:"6"}},[t._v("任务名")]),s("Col",{attrs:{span:"2"}},[t._v("大小")]),s("Col",{attrs:{span:"7"}},[t._v("进度")]),s("Col",{attrs:{span:"3"}},[t._v("任务状态")]),s("Col",{attrs:{span:"4"}},[t._v("开始时间")]),s("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloading,function(e){return s("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[s("Row",[s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),s("Col",{attrs:{span:"7"}},[s("Progress",{attrs:{percent:e.percent,status:"active"}})],1),s("Col",{attrs:{span:"3"}},[t._v(t._s(e.status_text))]),s("Col",{attrs:{span:"4"}},[t._v(t._s(e.stime))]),s("Col",{attrs:{span:"2"}},[s("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(s){t.deleteTask(e)}}})],1)],1)],1)})],2),s("div",{directives:[{name:"show",rawName:"v-show",value:"3-2"===t.select_menu_name,expression:"select_menu_name === '3-2'"}]},[s("Card",{staticStyle:{"margin-top":"16px"},attrs:{bordered:!1}},[s("Row",[s("Col",{attrs:{span:"6"}},[t._v("任务名")]),s("Col",{attrs:{span:"2"}},[t._v("任务状态")]),s("Col",{attrs:{span:"2"}},[t._v("大小")]),s("Col",{attrs:{span:"8"}},[t._v("路径")]),s("Col",{attrs:{span:"4"}},[t._v("完成时间")]),s("Col",{attrs:{span:"2"}},[t._v("操作")])],1)],1),t._l(t.offline_downloaded,function(e){return s("Card",{staticStyle:{"margin-top":"2px"},attrs:{bordered:!1}},[s("Row",[s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"},attrs:{title:e.taskname,span:"6"}},[t._v("\n            "+t._s(e.taskname)+"\n          ")]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.status_text))]),s("Col",{attrs:{span:"2"}},[t._v(t._s(e.file_size))]),s("Col",{staticStyle:{overflow:"hidden","white-space":"nowrap"},attrs:{title:e.path,span:"8"}},[t._v(t._s(e.path))]),s("Col",{attrs:{span:"4"}},[t._v(t._s(e.ftime))]),s("Col",{attrs:{span:"2"}},[s("Button",{attrs:{icon:"md-close",type:"error",size:"small",ghost:""},on:{click:function(s){t.deleteTask(e)}}})],1)],1)],1)})],2)],1)],1)},n=[];function i(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}function o(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(t){return i(t)||o(t)||r()}s("96cf");var c=s("3040"),u=s("c93e"),d=(s("cadf"),s("551c"),s("097d"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"child-download-items"},[s("Modal",{attrs:{draggable:"",title:"任务详情",width:800},model:{value:t.modalDetailFlag,callback:function(e){t.modalDetailFlag=e},expression:"modalDetailFlag"}},[s("Row",[s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("任务ID")])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("任务状态")])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("速度")])]),s("Col",{attrs:{span:"12"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v("错误信息")])])],1),s("div",{staticStyle:{height:"60vh","overflow-y":"auto"}},t._l(t.taskDetail,function(e){return s("Row",[s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.id))])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.status))])]),s("Col",{attrs:{span:"4"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.speed)+"/s")])]),s("Col",{attrs:{span:"12"}},[s("p",{staticStyle:{"font-size":"14px"}},[t._v(t._s(e.error))])])],1)})),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"info"},on:{click:function(e){t.modalDetailFlag=!1}}},[t._v("确认")])],1)],1),s("div",{staticClass:"items-list"},t._l(t.items,function(e){return s("div",{staticClass:"item"},[s("h3",{staticClass:"i-title"},[s("span",[t._v(t._s(e.name))]),1===t.istatus?s("span",[1===t.itype?[t._v("等待下载...")]:t._e(),2===t.itype?[t._v("等待上传...")]:t._e()],2):s("span",[t._v(t._s(e.total_size))])]),s("div",{staticClass:"i-body"},[s("div",{staticClass:"b-progress"},[s("div",{staticClass:"v-progress",class:{success:e.percent>=100}},[s("div",{staticClass:"p-bar"},[s("div",{staticClass:"b-fg",style:"width: "+e.percent+"%;"})]),s("div",{staticClass:"p-text"},[t._v(t._s(e.percent)+"%")])])]),1===t.itype&&2===t.istatus?s("div",{staticClass:"b-actions"},[e.is_pause?s("button",{staticClass:"ivu-btn ivu-btn-warning ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(s){t.switchDownloadStatus(e)}}},[s("Icon",{attrs:{type:"md-play"}})],1):s("button",{staticClass:"ivu-btn ivu-btn-warning ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(s){t.switchDownloadStatus(e)}}},[s("Icon",{attrs:{type:"md-pause"}})],1),s("button",{staticClass:"ivu-btn ivu-btn-error ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(s){t.cancelTask(e)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("button",{staticClass:"ivu-btn ivu-btn-info ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(s){t.detailTask(e)}}},[s("Icon",{attrs:{type:"md-barcode"}})],1)]):t._e(),s("div",{staticClass:"b-info"},[s("span",[t._v("速度: "+t._s(e.speed)+"/s")]),1===t.itype?s("span",[t._v("已经下载: "+t._s(e.download_size))]):t._e(),2===t.itype?s("span",[t._v("已经上传: "+t._s(e.uploaded_size))]):t._e(),s("span",[t._v("已用时间: "+t._s(e.time_used))]),s("span",[t._v("预计还需: "+t._s(e.time_left))])])])])}))],1)}),p=[],m=s("c276"),_={name:"v-download-process-item",data:function(){return{modalDetailFlag:!1,taskDetail:[]}},props:["items","itype","istatus"],methods:{switchDownloadStatus:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s=e.is_pause?"resume":"pause",t.next=3,$axios.get("download?method=".concat(s,"&id=").concat(e.LastID)).catch(this.error);case 3:a=t.sent,0===a.data.code?this.$Message.success("操作成功"):this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),cancelTask:function(t){var e=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var s=Object(c["a"])(regeneratorRuntime.mark(function s(){var a;return regeneratorRuntime.wrap(function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,$axios.get("download?method=cancel&id=".concat(t.LastID)).catch(e.error);case 2:a=s.sent,0===a.data.code?e.$Message.success("操作成功"):e.$Message.error({content:a.data.msg,duration:10,closable:!0});case 4:case"end":return s.stop()}},s,this)}));return function(){return s.apply(this,arguments)}}()})},getTaskStatus:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var s,a,n,i,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("download?method=status&id=".concat(e)).catch(this.error);case 2:if(s=t.sent,0===s.data.code){for(this.taskDetail=[],a=s.data.data,n=0;n<a.length;n++)i="","<nil>"!==a[n].error&&(i=a[n].error),this.taskDetail.push({id:a[n].id,status:a[n].status,speed:m["a"].bytesToSize(a[n].speed),error:i});this.modalDetailFlag&&setTimeout(function(){return o.getTaskStatus(e)},1e3)}else this.$Message.info({content:s.data.msg,duration:10,closable:!0}),this.modalDetailFlag=!1;case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),detailTask:function(t){this.getTaskStatus(t.LastID),this.modalDetailFlag=!0}}},v=_,h=s("2877"),f=Object(h["a"])(v,d,p,!1,null,null,null);f.options.__file="DownloadProcessItem.vue";var w=f.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"child-finished"},[s("div",{staticClass:"items-list"},t._l(t.items,function(e){return s("div",{staticClass:"item"},[s("h3",{staticClass:"i-title"},[s("span",[t._v(t._s(e.name))]),s("span",[t._v(t._s(e.total_size))])]),s("div",{staticClass:"i-body"},[s("Icon",{attrs:{type:"md-checkmark-circle",size:"24",color:"#19be6b"}}),s("span",[t._v("平均速度: "+t._s(e.avg_speed)+"/s")]),s("span",[t._v("已用时间: "+t._s(e.time_used))]),1===t.itype?s("span",[t._v("保存本地")]):t._e(),2===t.itype?s("span",[t._v("保存云端")]):t._e(),s("span",[t._v("路径: "+t._s(e.save_path))]),1===t.itype?s("button",{staticClass:"ivu-btn ivu-btn-success ivu-btn-small ivu-btn-ghost",attrs:{type:"button"},on:{click:function(s){t.openFolder(e.save_path)}}},[t._v("打开下载目录")]):t._e()],1)])}))])},b=[],y=(s("c5f6"),{name:"v-finished",props:{items:Array,itype:Number},methods:{openFolder:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("local_file?method=open_folder&path=".concat(encodeURIComponent(e))).catch(this.error);case 2:s=t.sent,0!==s.data.code&&this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}),k=y,C=Object(h["a"])(k,g,b,!1,null,null,null);C.options.__file="Finished.vue";var x=C.exports,S=s("db49"),T=s("2f62"),z={name:"v-download",data:function(){return{select_menu_name:"1-1",base_url:S["a"].base_url,ws_url:S["a"].ws_url,modalDetailFlag:!1,offline_downloaded:[],offline_downloading:[]}},computed:Object(u["a"])({},Object(T["c"])(["globals","websocket"])),components:{VDownloadProcessItem:w,VFinished:x},methods:Object(u["a"])({},Object(T["b"])(["initWS"]),{initWebSocket:function(){null===this.websocket&&this.initWS()},getMenuName:function(t){this.select_menu_name=t,"3-1"!==t&&"3-2"!==t||this.getOfflineTask()},deleteTask:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(e){var s,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s="delete",0!==e.status&&(s="cancel"),t.next=4,$axios.get("offline_download?method=".concat(s,"&id=").concat(e.taskid)).catch(this.error);case 4:a=t.sent,0===a.data.code?(this.$Message.success("删除成功"),this.getOfflineTask()):this.$Message.error({content:a.data.msg,duration:10,closable:!0});case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getOfflineTask:function(){var t=Object(c["a"])(regeneratorRuntime.mark(function t(){var e,s,a,n,i,o,r,l=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("offline_download?method=list").catch(this.error);case 2:if(e=t.sent,0===e.data.code){for(s=e.data.data,a=[],n=[],i=0;i<s.length;i++)o=s[i],0===o.Status?a.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:m["a"].bytesToSize(o.FileSize),finished_size:m["a"].bytesToSize(o.FinishedSize),ftime:m["a"].formatDateTime(1e3*o.FinishTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}):(r=(1*o.FinishedSize/(1*o.FileSize)*100).toFixed(2),n.push({taskid:o.TaskID,taskname:o.TaskName,status:o.Status,status_text:o.StatusText,file_size:m["a"].bytesToSize(o.FileSize),finished_size:m["a"].bytesToSize(o.FinishedSize),percent:1*r,stime:m["a"].formatDateTime(1e3*o.StartTime),path:o.SavePath,url:o.SourceURL,type:o.OdType}));this.offline_downloaded=a,this.offline_downloading=n,n.length>0&&setTimeout(function(){return l.getOfflineTask()},1e3)}else this.$Message.error({content:e.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),cancelAll:function(){var t=this;this.$Modal.confirm({title:"删除任务后无法恢复, 确定吗?",onOk:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var s,a,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:s=l(t.globals.downloading.map(function(t){return t.LastID})).concat(l(t.globals.pending_download.map(function(t){return t.LastID}))),n=0;case 2:if(!(n<s.length)){e.next=14;break}case 3:return e.next=5,m["a"].sleep();case 5:return e.next=7,$axios.get("download?method=cancel&id=".concat(s[n])).catch(t.error);case 7:a=e.sent;case 8:if(0!==a.data.code){e.next=3;break}case 9:return e.next=11,m["a"].sleep();case 11:n++,e.next=2;break;case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()})}}),created:function(){this.initWebSocket()}},D=z,I=Object(h["a"])(D,a,n,!1,null,null,null);I.options.__file="Download.vue";e["default"]=I.exports}}]);
//# sourceMappingURL=download.95382919.js.map